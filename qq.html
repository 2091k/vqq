<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>魏无羡影院 - 在线视频播放</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <style>
        :root {
            --primary-color: #ff6b6b;
            --bg-color: #2d3436;
            --text-color: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
        }

        /* 固定头部 */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(45, 52, 54, 0.95);
            padding: 1rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .header svg {
            flex-shrink: 0;
        }

        .title {
            font-size: 1.5rem;
            margin-left: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 搜索按钮 */
        .search-button {
            background: none;
            border: none;
            cursor: pointer;
            color: white;
            font-size: 1.2rem;
            transition: color 0.3s;
            margin-left: auto;
        }

        .search-button:hover {
            color: var(--primary-color);
        }

        /* 搜索弹窗及毛玻璃效果 */
        .search-modal {
            display: none;
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            padding: 20px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            z-index: 1001;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .search-modal.active {
            display: block;
        }

        .search-modal input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: none;
            border-radius: 4px;
            background: rgb(255 255 255 / 86%);
            color: #000000;
        }

        .search-modal button {
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .search-modal button:hover {
            background: #ff4747;
        }

        .container {
            margin-top: 70px;
            padding: 15px;
        }

        .source-tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .source-tab {
            flex-shrink: 0;
            padding: 8px 20px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border: none;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
        }

        .source-tab.active {
            background: var(--primary-color);
        }

        /* 视频列表 */
        .episodes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 767px) {
            .episodes {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .episode {
            text-align: center;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            transition: transform 0.3s;
        }

        .episode:hover {
            transform: scale(1.03);
        }

        .episode a {
            text-decoration: none;
            color: var(--text-color);
            display: block;
        }

        .episode img {
            width: 100%;
            height: auto;
            object-fit: cover;
            border-radius: 8px;
            transition: transform 0.3s;
        }

        .episode:hover img {
            transform: scale(1.05);
        }

        .episode .video-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.9rem;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
                margin: 90px auto 0;
                padding: 20px;
            }

            .episodes {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .source-tabs {
                flex-wrap: wrap;
                overflow-x: visible;
            }
        }
    </style>
    <link rel="icon" href="https://v.qq.com/favicon.ico">
    <script>
        <script>
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?d69e07b9eec7a81616400c95de2448f4";
                var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    </script>
</head>

<body>
    <div class="header">
        <!-- 将 SVG 图标用链接包裹，点击返回主页 -->
        <a href="http://vqq.2091k.cn" style="display: flex; align-items: center;">
            <svg id="custom-logo" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
                <g clip-path="url(#clip0_265_223)">
                    <path d="M6.1225 23.5028C6.801 28.0786 7.61233 31.518 12.9034 29.8054C17.9778 28.1705 22.8601 25.2644 27.1477 21.9701C28.6845 20.6519 31.3638 18.7922 31.4169 16.6075C31.3638 14.4146 28.6845 12.5631 27.1477 11.2429C22.856 7.94851 17.9778 5.04855 12.9034 3.4054C7.61233 1.69695 6.801 5.13848 6.1225 9.71014C5.59523 14.2926 5.59523 18.9204 6.1225 23.5028Z" fill="#0098FF"/>
                    <path d="M1.5054 10.5641C2.0858 7.53743 2.9564 5.34049 6.85775 6.0946C6.52076 7.27918 6.27481 8.48778 6.12203 9.70984C5.59523 14.2926 5.59523 18.9199 6.12203 23.5025C6.27601 24.7244 6.52194 25.9329 6.85775 27.1177C2.95844 27.8718 2.08784 25.6749 1.5054 22.648L1.46452 22.4316L1.38688 21.9943C0.896432 18.4189 0.896432 14.7934 1.38688 11.2181L1.46452 10.7807L1.5054 10.5641Z" fill="#FF8800"/>
                    <path d="M6.85821 6.09277C7.12798 6.14591 7.41409 6.21131 7.72881 6.29714C12.4619 7.57851 17.0213 9.84493 21.0249 12.4179C22.4554 13.4499 24.9569 14.8969 25.0059 16.6094C24.9569 18.322 22.4534 19.7689 21.0249 20.798C17.0213 23.3719 12.4619 25.6404 7.72881 26.9197C7.44221 27.0023 7.15165 27.0706 6.85821 27.1243C6.52143 25.9388 6.27548 24.7295 6.1225 23.5068C5.59523 18.9244 5.59523 14.2966 6.1225 9.71414C6.27562 8.49934 6.5195 7.29761 6.85209 6.11934L6.85821 6.09277Z" fill="#37E700"/>
                    <path d="M9.65007 12.2585C9.65007 12.2585 9.35986 12.7286 9.35986 16.6156C9.35986 20.5026 9.65007 20.9482 9.65007 20.9482C9.74817 21.4305 9.94027 21.5837 10.4675 21.4611C10.4675 21.4611 11.3381 21.3262 14.8164 19.5564C18.2947 17.7866 18.8751 17.1183 18.8751 17.1183C19.2491 16.7403 19.3493 16.4889 18.8751 16.0965C18.8751 16.0965 17.9187 15.2136 14.8164 13.6053C11.7142 11.9969 10.4675 11.7456 10.4675 11.7456C10.0404 11.6229 9.76452 11.7619 9.65007 12.2585Z" fill="white"/>
                </g>
                <defs>
                    <clipPath id="clip0_265_223">
                        <rect width="124" height="126" fill="white" transform="translate(1 2.73779)"/>
                    </clipPath>
                </defs>
            </svg>
        </a>
        <h1 class="title">魏无羡影院</h1>
        <button class="search-button" onclick="openSearchModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#ffffff"/>
            </svg>
        </button>
    </div>

    <div class="search-modal" id="search-modal">
        <input type="text" id="search-input" placeholder="输入搜索关键词">
        <button onclick="searchVideos()">搜索</button>
    </div>

    <div class="container">
        <div class="source-tabs">
            <button class="source-tab" data-type="电影" onclick="showSource('电影')">电影 (0)</button>
            <button class="source-tab" data-type="电视剧" onclick="showSource('电视剧')">电视剧 (0)</button>
        </div>
        <!-- 动态内容将插入到这里 -->
    </div>

    <script>
         // 修复1：使用可靠的CORS代理
        const API_BASE = 'https://api.allorigins.win/raw?url=';
        let currentData = [];

        // 修复2：增强的fetch函数
        async function fetchData(type) {
            try {
                const url = encodeURIComponent(`http://vqqadmin.2091k.cn/?type=${type}&page=1`);
                const res = await fetch(API_BASE + url);
                
                if (!res.ok) throw new Error(`请求失败: ${res.status}`);
                
                const data = await res.json();
                if (!Array.isArray(data)) throw new Error('无效的API响应格式');
                
                return data.map(item => ({
                    title: item.title || '未知标题',
                    path: item.path || '#',
                    img: (item.img || 'https://placehold.co/195x260').replace('http://', 'https://')
                }));
            } catch (error) {
                console.error('数据加载失败:', error);
                showError(`${type}加载失败: ${error.message}`);
                return [];
            }
        }

        // 修复3：完整的错误处理
        function showError(msg) {
            const existing = document.querySelector('.error-message');
            if (existing) existing.remove();
            
            const div = document.createElement('div');
            div.className = 'error-message';
            div.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #ff6b6b;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 9999;
                animation: fadeIn 0.3s;
            `;
            div.textContent = msg;
            document.body.appendChild(div);
            
            setTimeout(() => div.remove(), 3000);
        }

        // 修复4：安全的DOM操作
        function updateTabCount(type, count) {
            document.querySelectorAll('.source-tab').forEach(tab => {
                if (tab.dataset.type === type) {
                    tab.textContent = `${type} (${count})`;
                }
            });
        }

    function renderEpisodes(data, type) {
        const container = document.querySelector('.container');
        let episodesDiv = document.getElementById(type);
        
        if (!episodesDiv) {
            episodesDiv = document.createElement('div');
            episodesDiv.className = 'episodes';
            episodesDiv.id = type;
            container.appendChild(episodesDiv);
        }

        episodesDiv.innerHTML = data.length > 0 ? 
            data.map(item => `
                <div class="episode" data-name="${item.title}">
                    <a href="${item.path}" onclick="handleVideoClick(event, '${item.path}')">
                        <img src="${item.img}" alt="${item.title}"
                             onerror="this.src='https://placehold.co/200x300?text=封面加载失败'">
                        <div class="video-name">${item.title}</div>
                    </a>
                </div>
            `).join('') : 
            '<div class="no-data" style="text-align:center;width:100%;padding:20px;">暂无内容</div>';
        
        // 只显示当前分类内容
        episodesDiv.style.display = 'grid';
    }

        // 修复5：统一的事件监听
    function initEventListeners() {
        document.querySelectorAll('.source-tab').forEach(tab => {
            tab.addEventListener('click', async function() {
                if (this.classList.contains('active')) return;
                
                // 隐藏所有内容
                document.querySelectorAll('.episodes').forEach(div => {
                    div.style.display = 'none';
                });
                
                document.querySelectorAll('.source-tab').forEach(t => {
                    t.classList.remove('active');
                });
                this.classList.add('active');
                
                const type = this.dataset.type;
                const episodesDiv = document.getElementById(type);
                
                // 如果内容未加载则获取数据
                if (!episodesDiv || episodesDiv.children.length === 0) {
                    const data = await fetchData(type);
                    renderEpisodes(data, type);
                } else {
                    episodesDiv.style.display = 'grid';
                }
            });
        });

            // 搜索相关事件
            document.getElementById('search-input').addEventListener('keypress', e => {
                if (e.key === 'Enter') searchVideos();
            });
        }

    // 修复初始化函数（确保电视剧内容隐藏）
    async function init() {
        try {
            initEventListeners();
            
            const [movieData, tvData] = await Promise.all([
                fetchData('电影'),
                fetchData('电视剧')
            ]);
            
            updateTabCount('电影', movieData.length);
            updateTabCount('电视剧', tvData.length);
            
            renderEpisodes(movieData, '电影');
            renderEpisodes(tvData, '电视剧'); // 提前渲染但隐藏
            
            const movieTab = document.querySelector('[data-type="电影"]');
            movieTab.classList.add('active');
            
            document.getElementById('电视剧').style.display = 'none';
        } catch (error) {
            showError(`初始化失败: ${error.message}`);
        }
    }

    // 新增视频点击处理
    function handleVideoClick(event, path) {
        event.preventDefault();
        window.location.href = path; // 在当前页面跳转
    }
	
    // 修复1：增强搜索功能
    function searchVideos() {
        const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
        const allEpisodes = document.querySelectorAll('.episode');
        let activeCategory = null;

        if (!searchTerm) {
            // 清空搜索时恢复显示
            allEpisodes.forEach(episode => episode.style.display = 'block');
            document.querySelectorAll('.episodes').forEach(div => div.style.display = 'none');
            document.querySelector('.source-tab.active')?.click();
            return;
        }

        // 查找匹配项并确定分类
        allEpisodes.forEach(episode => {
            const name = episode.dataset.name.toLowerCase();
            const match = name.includes(searchTerm);
            if (match) {
                activeCategory = episode.closest('.episodes').id;
            }
            episode.style.display = match ? 'block' : 'none';
        });

        // 自动切换分类
        if (activeCategory) {
            const targetTab = document.querySelector(`[data-type="${activeCategory}"]`);
            if (targetTab && !targetTab.classList.contains('active')) {
                targetTab.click();
            }
        }

        closeSearchModal();
    }
	
	    // 修复2：点击外部关闭搜索框
    document.addEventListener('click', (e) => {
        const searchModal = document.getElementById('search-modal');
        const searchButton = document.querySelector('.search-button');
        
        if (!searchModal.contains(e.target) && !searchButton.contains(e.target)) {
            closeSearchModal();
        }
    });

        // 修复8：定义缺失的函数
        function openSearchModal() {
            document.getElementById('search-modal').classList.add('active');
        }

        function closeSearchModal() {
            document.getElementById('search-modal').classList.remove('active');
        }

        // 安全启动
        window.addEventListener('DOMContentLoaded', init);
    </script>

    </script>
</body>

</html>