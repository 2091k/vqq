<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>é­æ— ç¾¡å½±é™¢ - åœ¨çº¿è§†é¢‘æ’­æ”¾</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <script>
        var PROXY_BASE = 'http://jasu.2091k.cn/';
        var SEARCH_API_GROUPS = [
          {
           name: 'ä¸»ç«™',
            keywordApi: 'http://newtv.2091k.cn/?keyword=',
            idApi: 'http://newtv.2091k.cn/?id='
          }
        ];
    </script>
    <style>
        :root {
            --primary-color: #ff6b6b;
            --bg-color: #2d3436;
            --text-color: #ffffff;
            --gray-color: rgba(255,255,255,0.7);
        }
		.category-tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  overflow-x: auto;
}
.category-tab {
  padding: 8px 20px;
  border-radius: 20px;
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-color);
  border: none;
  cursor: pointer;
  transition: background 0.3s, transform 0.3s;
}
.category-tab.active {
  background: var(--primary-color);
}
		.spinner-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(45,52,54,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid rgba(255,255,255,0.3);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background: var(--bg-color);
            color: var(--text-color);
        }
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(45, 52, 54, 0.95);
            padding: 1rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .header svg {
            flex-shrink: 0;
        }
        .title {
            font-size: 1.5rem;
            margin-left: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* æŒ‰é’®æ ·å¼ï¼šç»Ÿä¸€å›¾æ ‡å°ºå¯¸ä¸é—´è· */
        .history-button, .search-button {
            background: none;
            border: none;
            cursor: pointer;
            color: white;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2px 0;
        }
        .history-button {
            margin-left: auto;
            margin-right: 15px; /* ä¸æœç´¢æŒ‰é’®ç´§æŒ¨ç€ */
        }
        .search-button {
            margin-left: 0;
        }
        .history-button:hover, .search-button:hover {
            color: var(--primary-color);
        }
        /* å…³é”®ï¼šæœç´¢è¾“å…¥æ¡†ï¼ˆæ·»åŠ SVGèƒŒæ™¯å›¾æ ‡ï¼‰ */
        #search-input {
            width: 100%;
            padding: 15px 25px 15px 45px; /* å·¦ä¾§ç•™ç©ºæ”¾SVG */
            margin-bottom: 20px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.9);
            color: #2d3436;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            /* æœç´¢SVGèƒŒæ™¯ */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 22 22' fill='none'%3E%3Cg stroke='%23666' stroke-width='1.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cellipse cx='9' cy='9' rx='6.96667' ry='6.96667' transform='rotate(-45 9 9)'/%3E%3Cline x1='15.5' y1='15.5' x2='15.5' y2='19' transform='rotate(-45 15.5 17.25)'/%3E%3C/g%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 15px center; /* å›¾æ ‡å®šä½ */
            background-size: 18px; /* å›¾æ ‡å¤§å° */
        }
        #search-input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        .search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 998;
            display: none;
        }
        .search-modal {
            display: none;
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            border-radius: 20px;
            background: rgb(45 52 54 / 0%);
            backdrop-filter: blur(30px);
            z-index: 999;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: all 0.3s ease;
        }
        .search-modal.active {
            display: block;
            opacity: 1;
            animation: modalSlideIn 0.3s ease;
        }
        @keyframes modalSlideIn {
            from {
                transform: translate(-50%, -60%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }
        .search-modal button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ff4747 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        .search-modal button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        .search-modal button:active {
            transform: translateY(0);
        }
        .container {
            margin-top: 70px;
            padding: 15px;
        }
        .source-tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .source-tab {
            flex-shrink: 0;
            padding: 8px 20px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border: none;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
        }
        .source-tab.active {
            background: var(--primary-color);
        }
        .episodes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        @media (max-width: 767px) {
            .episodes {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .episode {
            text-align: center;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            transition: transform 0.3s;
        }
        .episode:hover {
            transform: scale(1.03);
        }
        .episode a {
            text-decoration: none;
            color: var(--text-color);
            display: block;
        }
        .episode img {
            width: 100%;
            height: auto;
            object-fit: cover;
            border-radius: 8px;
            transition: transform 0.3s;
        }
        .episode:hover img {
            transform: scale(1.05);
        }
        .episode .video-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.9rem;
        }
        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
                margin: 90px auto 0;
                padding: 20px;
            }
            .episodes {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            .source-tabs {
                flex-wrap: wrap;
                overflow-x: visible;
            }
        }
		.notice-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(8px);
    z-index: 1500;
    display: none;
}
.notice-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgb(255 255 255 / 19%);
    backdrop-filter: blur(15px);
    color: white;
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 400px;
    z-index: 1501;
    display: none;
    text-align: center;
    box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
    animation: fadeIn 0.5s ease;
}
.notice-modal h2 {
    font-size: 1.5rem;
    margin-bottom: 15px;
}
.notice-modal p {
    font-size: 1rem;
    margin-bottom: 20px;
}
.notice-modal button {
    padding: 10px 25px;
    border: none;
    border-radius: 25px;
    background: var(--primary-color);
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
}
.notice-modal button:hover {
    background: #ff4c4c;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translate(-50%, -60%); }
    to { opacity: 1; transform: translate(-50%, -50%); }
}

        .search-result-item {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        .search-result-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        .search-result-poster {
            flex: 0 0 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }
        .search-result-poster img {
            width: 100%;
            height: auto;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
        }
        .search-result-info {
            flex: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .search-result-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        .detail-item {
            display: flex;
        }
        .detail-label {
            color: rgba(255, 255, 255, 0.7);
            margin-right: 8px;
            flex-shrink: 0;
        }
        .detail-content {
            color: rgba(255, 255, 255, 0.9);
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .search-result-intro {
            margin-top: 10px;
            font-size: 0.85rem;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.8);
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
@media (max-width: 767px) {
    .search-result-item {
        flex-direction: row; 
        align-items: flex-start; 
        gap: 10px; 
    }
    .search-result-poster {
        flex: 0 0 80px; 
        padding: 10px 0 10px 10px; 
        align-items: flex-start; 
    }
    .search-result-poster img {
        width: 100%; 
        max-height: 120px; 
        object-fit: cover; 
    }
    .search-result-info {
        flex: 1; 
        padding: 10px 10px 10px 0; 
    }

    .search-result-top-info {
        display: flex; 
        flex-wrap: wrap; 
        gap: 8px; 
        margin-bottom: 8px; 
    }
    .search-result-top-info .detail-item {
        flex: 1 1 auto; 
        white-space: nowrap; 
        font-size: 0.85rem; 
    }

    .search-result-bottom-info {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }
    .search-result-bottom-info .detail-item {
        font-size: 0.85rem;
    }

    .search-result-intro {
        font-size: 0.85rem;
        line-height: 1.4;
        display: block;
        -webkit-line-clamp: none;
        overflow: visible;
    }

    .detail-label {
        margin-right: 4px; 
        color: rgba(255, 255, 255, 0.8);
    }
    .detail-content {
        color: rgba(255, 255, 255, 0.95);
    }
}
        @media (min-width: 1200px) {
            .search-result-poster {
                flex: 0 0 180px;
            }
            .search-result-poster img {
                max-height: 240px;
            }
        }

        .watch-history-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 998;
            display: none;
        }
        .watch-history-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            padding: 25px;
            border-radius: 20px;
            background: rgb(45 52 54 / 80%);
            backdrop-filter: blur(30px);
            z-index: 999;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: all 0.3s ease;
            overflow-y: auto;
        }
        .watch-history-modal.active {
            display: block;
            opacity: 1;
            animation: modalSlideIn 0.3s ease;
        }
        .watch-history-modal h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: center;
        }
        .watch-history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .history-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .history-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        .history-item-title {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .history-item-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray-color);
        }
        .history-empty {
            text-align: center;
            padding: 50px 20px;
            color: var(--gray-color);
            font-size: 0.9rem;
        }
        .clear-history-btn {
            width: 100%;
            margin-top: 20px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--gray-color);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .clear-history-btn:hover {
            background: rgba(255, 88, 88, 0.2);
            color: #ff6b6b;
        }
    </style>
    <link rel="icon" href="http://v.qq.com/favicon.ico">
</head>
<body>
    <div class="header">
        <a href="http://vqq.2091k.cn" style="display:flex;align-items:center;">
            <svg id="custom-logo" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
            <g clip-path="url(#clip0_265_223)">
                <path d="M6.1225 23.5028C6.801 28.0786 7.61233 31.518 12.9034 29.8054C17.9778 28.1705 22.8601 25.2644 27.1477 21.9701C28.6845 20.6519 31.3638 18.7922 31.4169 16.6075C31.3638 14.4146 28.6845 12.5631 27.1477 11.2429C22.856 7.94851 17.9778 5.04855 12.9034 3.4054C7.61233 1.69695 6.801 5.13848 6.1225 9.71014C5.59523 14.2926 5.59523 18.9204 6.1225 23.5028Z" fill="#0098FF"/>
                <path d="M1.5054 10.5641C2.0858 7.53743 2.9564 5.34049 6.85775 6.0946C6.52076 7.27918 6.27481 8.48778 6.12203 9.70984C5.59523 14.2926 5.59523 18.9199 6.12203 23.5025C6.27601 24.7244 6.52194 25.9329 6.85775 27.1177C2.95844 27.8718 2.08784 25.6749 1.5054 22.648L1.46452 22.4316L1.38688 21.9943C0.896432 18.4189 0.896432 14.7934 1.38688 11.2181L1.46452 10.7807L1.5054 10.5641Z" fill="#FF8800"/>
                <path d="M6.85821 6.09277C7.12798 6.14591 7.41409 6.21131 7.72881 6.29714C12.4619 7.57851 17.0213 9.84493 21.0249 12.4179C22.4554 13.4499 24.9569 14.8969 25.0059 16.6094C24.9569 18.322 22.4534 19.7689 21.0249 20.798C17.0213 23.3719 12.4619 25.6404 7.72881 26.9197C7.44221 27.0023 7.15165 27.0706 6.85821 27.1243C6.52143 25.9388 6.27548 24.7295 6.1225 23.5068C5.59523 18.9244 5.59523 14.2966 6.1225 9.71414C6.27562 8.49934 6.5195 7.29761 6.85209 6.11934L6.85821 6.09277Z" fill="#37E700"/>
                <path d="M9.65007 12.2585C9.65007 12.2585 9.35986 12.7286 9.35986 16.6156C9.35986 20.5026 9.65007 20.9482 9.65007 20.9482C9.74817 21.4305 9.94027 21.5837 10.4675 21.4611C10.4675 21.4611 11.3381 21.3262 14.8164 19.5564C18.2947 17.7866 18.8751 17.1183 18.8751 17.1183C19.2491 16.7403 19.3493 16.4889 18.8751 16.0965C18.8751 16.0965 17.9187 15.2136 14.8164 13.6053C11.7142 11.9969 10.4675 11.7456 10.4675 11.7456C10.0404 11.6229 9.76452 11.7619 9.65007 12.2585Z" fill="white"/>
            </g>
                <defs>
                    <clipPath id="clip0_265_223">
                        <rect width="124" height="126" fill="white" transform="translate(1 2.73779)"/>
                    </clipPath>
                </defs>
            </svg>
        </a>
        <h1 class="title">é­æ— ç¾¡å½±é™¢</h1>
        
        <!-- 1. æ’­æ”¾è®°å½•SVGï¼ˆåŸå°ºå¯¸ï¼Œåœ†åŠå¾„6.96667ï¼‰ -->
        <button class="history-button" onclick="openWatchHistoryModal()">
            <svg class="svg_quick_icon svg_icon_history" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22" fill="none">
                <g stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="7.96667"/>
                    <path d="M14.87 11.77H11V7.13"/>
                </g>
            </svg>
        </button>
        
        <!-- 2. æœç´¢æŒ‰é’®SVGï¼ˆä¿®æ”¹åï¼šåœ†åŠå¾„ä¸æ’­æ”¾è®°å½•ä¸€è‡´ï¼Œ22x22å°ºå¯¸ï¼‰ -->
        <button class="search-button" onclick="openSearchModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 22 22" fill="none">
                <g stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round">
                    <!-- åœ†ï¼šrx=6.96667ï¼ˆä¸æ’­æ”¾è®°å½•ä¸€è‡´ï¼‰ï¼Œæ—‹è½¬åå±…ä¸­ -->
                    <ellipse cx="9" cy="9" rx="7.96667" ry="7.96667" transform="rotate(-45 9 9)"/>
                    <!-- ç›´çº¿ï¼šè°ƒæ•´ä½ç½®é€‚é…æ–°åœ† -->
                    <line x1="15.5" y1="15.5" x2="15.5" y2="19" transform="rotate(-45 15.5 17.25)"/>
                </g>
            </svg>
        </button>
    </div>

    <div class="watch-history-overlay" id="watch-history-overlay" onclick="closeWatchHistoryModal()"></div>
    <div class="watch-history-modal" id="watch-history-modal">
        <h3>æ’­æ”¾è®°å½•</h3>
        <p style="text-align: center; font-size: 15px; color: #666666;">è®°å½•çš„æ˜¯è§‚çœ‹æ—¶é•¿ï¼Œéå½±ç‰‡è§‚çœ‹è¿›åº¦ã€‚</p>
        </br>
        <div id="watch-history-list" class="watch-history-list"></div>
        <button class="clear-history-btn" onclick="clearWatchHistory()">æ¸…ç©ºæ‰€æœ‰è®°å½•</button>
    </div>

    <div class="search-overlay" id="search-overlay" onclick="closeSearchModal()"></div>
    <div class="search-modal" id="search-modal">
        <!-- 3. æœç´¢è¾“å…¥æ¡†ï¼šç”¨CSSèƒŒæ™¯SVGæ›¿ä»£emojiï¼Œplaceholderåªä¿ç•™æ–‡å­— -->
        <input type="text" id="search-input" placeholder="è¾“å…¥å½±ç‰‡åç§°...">
        <button onclick="performSearch()">ç«‹å³æœç´¢</button>
    </div>

    <div class="container" id="main-container">
        <div class="category-tabs" id="category-tabs"></div>
        <div id="video-lists"></div>
    </div>

    <div class="spinner-overlay" id="spinner-overlay"><div class="spinner"></div></div>

    <div class="notice-overlay" id="noticeOverlay"></div>
    <div class="notice-modal" id="noticeModal">
        <h2>ğŸ“¢ å…¬å‘Š</h2>
        <p>æœ¬ç«™èµ„æºå‡é‡‡é›†è‡ªç½‘ç»œï¼Œä»…ä¾›å­¦ä¹ äº¤æµï¼Œåˆ‡å‹¿ç”¨äºå•†ä¸šç”¨é€”ã€‚å¦‚æœ‰ä¾µæƒï¼Œè¯·åŠæ—¶è”ç³»åˆ é™¤ã€‚</p>
		<p>â€¢ PCç«¯æ— æ³•æ­£å¸¸æ˜¾ç¤ºæ—¶ï¼Œæµè§ˆå™¨æ¸…é™¤ç¼“å­˜å…³é—­åé‡æ–°æ‰“å¼€å³å¯httpä¸å¸¦så³å¯æ­£å¸¸</p>
        <p>â€¢ æ·»åŠ å…¨ç½‘æœç´¢åŠŸèƒ½</p>
        <button onclick="closeNotice()">æˆ‘çŸ¥é“äº†</button>
    </div>
	
    <script>
        const CONFIG = {
            proxyBase: typeof PROXY_BASE !== 'undefined' ? PROXY_BASE : '',
            searchApis: SEARCH_API_GROUPS || []
        };
        let CURRENT_DATA = {};

async function fetchCleanJson(url) {
    const res = await fetch(url);
    if (!res.ok) throw new Error(res.status);
    let text = await res.text();
    if (text.includes('\\\\')) {
        text = text.replace(/\\\\/g, '\\'); 
    }
    try {
        return JSON.parse(text);
    } catch (parseErr) {
        console.error('JSONè§£æå¤±è´¥ï¼ŒåŸå§‹æ–‡æœ¬ï¼š', text.slice(0, 200));
        throw new Error(`JSONè§£æé”™è¯¯: ${parseErr.message}`);
    }
}

        function showSpinner() {
            document.getElementById('spinner-overlay').style.display = 'flex';
        }
        function hideSpinner() {
            document.getElementById('spinner-overlay').style.display = 'none';
        }
        function showError(msg) {
            alert(msg);
        }

async function init() {
    showSpinner();
    try {
        const [movies, tvs, anime] = await Promise.all([
            fetchHomeData('ç”µå½±'),
            fetchHomeData('ç”µè§†å‰§'),
            fetchHomeData('åŠ¨æ¼«')
        ]);
        CURRENT_DATA = { 'ç”µå½±': movies, 'ç”µè§†å‰§': tvs, 'åŠ¨æ¼«': anime};
        renderCategoryTabs();
        switchCategory('ç”µå½±');
    } catch (e) {
        showError('é¦–é¡µåŠ è½½å¤±è´¥: ' + e.message);
    } finally {
        hideSpinner();
    }
}

        async function fetchHomeData(type) {
            const proxyUrl = CONFIG.proxyBase + encodeURIComponent(`http://vqqadmin.2091k.cn/?type=${type}&page=1`);
            const res = await fetch(proxyUrl);
            if (!res.ok) throw new Error(res.status);
            const data = await res.json();
            return data.map(item => ({
                vod_id: item.id,
                vod_name: item.title,
                vod_pic: item.img.replace('http://', 'https://'),
                vod_feature: item.path
            }));
        }

        function renderCategoryTabs() {
            const tabs = document.getElementById('category-tabs');
            tabs.innerHTML = Object.keys(CURRENT_DATA).map(type => `
                <button class="category-tab" onclick="switchCategory('${type}')">
                    ${type} (${CURRENT_DATA[type].length})
                </button>
            `).join('');
        }

        function switchCategory(type) {
            document.querySelectorAll('.category-tab').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.includes(type));
            });
            renderVideoList(CURRENT_DATA[type]);
        }

        function renderVideoList(list) {
            const container = document.getElementById('video-lists');
            container.innerHTML = `
                <div class="episodes">
                    ${list.map(item => {
                        const escapedTitle = item.vod_name.replace(/'/g, "\\'");
                        return `
                        <div class="episode" onclick="searchByTitle('${escapedTitle}')">
                            <img src="${item.vod_pic}" onerror="this.src='http://fpoimg.com/195x260?text=å°é¢åŠ è½½å¤±è´¥'">
                            <div class="video-name">${item.vod_name}</div>
                        </div>
                        `;
                    }).join('')}
                </div>`;
        }

        function searchByTitle(customTitle = '') {
            const keyword = customTitle || document.getElementById('search-input').value.trim();
            if (!keyword) return showError('è¯·è¾“å…¥æœç´¢å†…å®¹');
            performSearch(keyword);
        }

        async function performSearch(customKeyword = '') {
            const keyword = customKeyword || document.getElementById('search-input').value.trim();
            if (!keyword) return showError('è¯·è¾“å…¥æœç´¢å†…å®¹');
            
            showSpinner();
            try {
                let result = null;
                for (const [index, api] of CONFIG.searchApis.entries()) {
                    try {
                        let apiUrl = api.keywordApi + encodeURIComponent(keyword);
                        if (CONFIG.proxyBase) {
                            apiUrl = CONFIG.proxyBase + encodeURIComponent(apiUrl);
                        }
                        const data = await fetchCleanJson(apiUrl);
                        if (data.list?.length) {
                            result = { data: data.list, apiIndex: index };
                            break;
                        }
                    } catch (e) {
                        console.warn(`[${api.name}] æœç´¢å¤±è´¥:`, e);
                    }
                }

                if (!result) {
                    document.getElementById('video-lists').innerHTML = `
                        <div style="text-align: center; padding: 50px 20px; color: #aaa;">
                            æ²¡æœ‰æ‰¾åˆ°ã€Œ${keyword}ã€ç›¸å…³å†…å®¹
                        </div>
                    `;
                    return;
                }

                renderSearchResults(result.data, result.apiIndex);
            } catch (e) {
                showError('æœç´¢å¤±è´¥: ' + e.message);
            } finally {
                hideSpinner();
                if (!customKeyword) closeSearchModal();
            }
        }

        function renderSearchResults(list, apiIndex) {
    const container = document.getElementById('video-lists');
    container.innerHTML = list.map(item => `
        <div class="search-result-item" onclick="loadVideoDetail(${item.vod_id}, ${apiIndex})">
            <div class="search-result-poster">
                <img src="${item.vod_pic || 'http://fpoimg.com/150x200?text=å°é¢åŠ è½½å¤±è´¥'}" 
                     onerror="this.src='http://fpoimg.com/150x200?text=å°é¢åŠ è½½å¤±è´¥'"
                     alt="${item.vod_name || 'æœªçŸ¥æ ‡é¢˜'}">
            </div>
            <div class="search-result-info">
                <div class="search-result-title">${item.vod_name || 'æœªçŸ¥æ ‡é¢˜'}</div>
                <div class="search-result-top-info">
                    <div class="detail-item">
                        <span class="detail-label">ç±»å‹ï¼š</span>
                        <span class="detail-content">${item.vod_type || 'æœªçŸ¥'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">åœ°åŒºï¼š</span>
                        <span class="detail-content">${item.vod_area || 'æœªçŸ¥'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">å¹´ä»½ï¼š</span>
                        <span class="detail-content">${item.vod_year || 'æœªçŸ¥'}</span>
                    </div>
                </div>
                <div class="search-result-bottom-info">
                    <div class="detail-item">
                        <span class="detail-label">ä¸»æ¼”ï¼š</span>
                        <span class="detail-content">${item.vod_actor || 'æœªçŸ¥'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">å¯¼æ¼”ï¼š</span>
                        <span class="detail-content">${item.vod_director || 'æœªçŸ¥'}</span>
                    </div>
                    <div class="search-result-intro">
                        <span class="detail-label">ç®€ä»‹ï¼š</span>
                        ${item.vod_content || 'æš‚æ— ç®€ä»‹'}
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

        async function loadVideoDetail(id, apiIndex, targetEpPath = '') {
            showSpinner();
            try {
                const api = CONFIG.searchApis[apiIndex];
                if (!api) throw new Error('æ— æ•ˆçš„APIé…ç½®');
                let apiUrl = api.idApi + id;
                if (CONFIG.proxyBase) {
                    apiUrl = CONFIG.proxyBase + encodeURIComponent(apiUrl);
                }
                
                const data = await fetchCleanJson(apiUrl);
                const info = data.list?.[0];
                if (!info) throw new Error('æ²¡æœ‰æ‰¾åˆ°è§†é¢‘è¯¦æƒ…');

                const cleanFrom = (info.vod_play_from || '').replace(/\\/g, '').split('|');
                const rawUrl = (info.vod_play_url || '').replace(/\\/g, '');
                const playUrl = rawUrl.split('$$$').map(group =>
                    group.split('|').map(item => {
                        const [name, path] = item.split('$');
                        return { name, path };
                    })
                );

                const playerData = {
                    title: info.vod_name,
                    playFrom: cleanFrom,
                    playUrl: playUrl,
                    cover: info.vod_pic,
                    vodId: info.vod_id,
                    apiIndex: apiIndex,
                    targetEpPath: targetEpPath
                };

                const storageKey = 'player_' + Date.now();
                localStorage.setItem(storageKey, JSON.stringify(playerData));
                const playerUrl = `player.html?key=${storageKey}`;
                window.open(playerUrl, '_blank');
            } catch (e) {
                showError('åŠ è½½å¤±è´¥: ' + e.message);
            } finally {
                hideSpinner();
            }
        }

        function openSearchModal() {
            document.getElementById('search-overlay').style.display = 'block';
            document.getElementById('search-modal').classList.add('active');
            setTimeout(() => document.getElementById('search-input').focus(), 100);
        }
        function closeSearchModal() {
            document.getElementById('search-overlay').style.display = 'none';
            document.getElementById('search-modal').classList.remove('active');
        }
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                closeSearchModal();
                closeWatchHistoryModal();
            }
        });
        document.getElementById('search-input').addEventListener('keypress', e => {
            if (e.key === 'Enter') performSearch();
        });
        window.addEventListener('DOMContentLoaded', init);

        function closeNotice() {
            document.getElementById('noticeOverlay').style.display = 'none';
            document.getElementById('noticeModal').style.display = 'none';
        }
        window.addEventListener('load', () => {
            document.getElementById('noticeOverlay').style.display = 'block';
            document.getElementById('noticeModal').style.display = 'block';
        });

        function goToWatchedEpisode(index) {
            const historyList = getWatchHistory();
            const item = historyList[index];
            if (!item) return showError('è®°å½•ä¸å­˜åœ¨');
            loadVideoDetail(item.vodId, item.apiIndex, item.playPath);
            closeWatchHistoryModal();
        }

        function openWatchHistoryModal() {
            document.getElementById('watch-history-overlay').style.display = 'block';
            document.getElementById('watch-history-modal').classList.add('active');
            renderWatchHistory();
        }

        function closeWatchHistoryModal() {
            document.getElementById('watch-history-overlay').style.display = 'none';
            document.getElementById('watch-history-modal').classList.remove('active');
        }

        function getWatchHistory() {
            const historyStr = localStorage.getItem('watchHistory');
            if (!historyStr) return [];
            return JSON.parse(historyStr).sort((a, b) => b.watchTime - a.watchTime);
        }

        function renderWatchHistory() {
            const historyList = getWatchHistory();
            const container = document.getElementById('watch-history-list');

            if (historyList.length === 0) {
                container.innerHTML = `
                    <div class="history-empty">
                        æš‚æ— æ’­æ”¾è®°å½•<br>
                        è§‚çœ‹è§†é¢‘åå°†è‡ªåŠ¨ä¿å­˜è®°å½•
                    </div>
                `;
                return;
            }

            container.innerHTML = historyList.map((item, index) => `
                <div class="history-item" onclick="goToWatchedEpisode(${index})">
                    <div class="history-item-title">${item.title} - ${item.episodeName}</div>
                    <div class="history-item-meta">
                        <span>è§‚çœ‹æ—¶é•¿ï¼š${formatTime(item.duration)}</span>
                        <span>æœ€åè§‚çœ‹ï¼š${formatDate(item.watchTime)}</span>
                    </div>
                </div>
            `).join('');
        }

        function clearWatchHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ’­æ”¾è®°å½•å—ï¼Ÿ')) {
                localStorage.removeItem('watchHistory');
                renderWatchHistory();
            }
        }

        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hour = date.getHours().toString().padStart(2, '0');
            const minute = date.getMinutes().toString().padStart(2, '0');
            return `${year}-${month}-${day} ${hour}:${minute}`;
        }
    </script>
</body>
</html>
